<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>LeanCloud on 阿波尔的博客</title>
    <link>https://www.zaqizaba.xyz/tags/leancloud/</link>
    <description>Recent content in LeanCloud on 阿波尔的博客</description>
    <generator>Hugo</generator>
    <language>EN</language>
    <copyright>&amp;copy; &lt;a href=&#34;https://www.zaqizaba.xyz&#34;&gt;阿波尔的博客&lt;/a&gt; 2019-2025</copyright>
    <lastBuildDate>Fri, 27 Feb 2026 19:25:59 +0800</lastBuildDate>
    <atom:link href="https://www.zaqizaba.xyz/tags/leancloud/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>将waline评论从LeanCloud迁徙到TiDB</title>
      <link>https://www.zaqizaba.xyz/posts/%E5%B0%86waline%E8%AF%84%E8%AE%BA%E4%BB%8Eleancloud%E8%BF%81%E5%BE%99%E5%88%B0tinb/</link>
      <pubDate>Fri, 27 Feb 2026 19:25:59 +0800</pubDate>
      <guid>https://www.zaqizaba.xyz/posts/%E5%B0%86waline%E8%AF%84%E8%AE%BA%E4%BB%8Eleancloud%E8%BF%81%E5%BE%99%E5%88%B0tinb/</guid>
      <description>&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%BB%98%E5%9B%BE.drawio.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%BB%98%E5%9B%BE.drawio.png&#34; alt=&#34;未命名绘图.drawio&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;这二天，登录博客waline后台，提示作为waline数据存储的LeanCloud即将永久停止对waline数据的支持，&lt;a href=&#34;https://docs.leancloud.app/sdk/announcements/sunset-announcement/&#34;&gt;具体文告&lt;/a&gt;看这里。不过好在还支持一年的数据存储支持。现在我就准备从LeanCloud迁移数据到TiDB 。&lt;/p&gt;&#xA;&lt;h1 id=&#34;1从leancloud导出数据&#34;&gt;1.从LeanCloud导出数据&lt;/h1&gt;&#xA;&lt;p&gt;登录&lt;a href=&#34;https://console.leancloud.app/&#34;&gt;LeanCloud&lt;/a&gt;国际版。选择 &lt;strong&gt;数据存储&lt;/strong&gt;》&lt;strong&gt;导入导出&lt;/strong&gt;》&lt;strong&gt;数据导出&lt;/strong&gt;》&lt;strong&gt;导出&lt;/strong&gt;，会提示数据发送到邮箱，注意查收下载。&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E6%95%B0%E6%8D%AE.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E6%95%B0%E6%8D%AE.png&#34; alt=&#34;数据&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;我导出的格式是&lt;code&gt;JSONL&lt;/code&gt;，其实也是符合的。&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/json.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/json.png&#34; alt=&#34;json&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;h1 id=&#34;2创建tidb数据库并连接&#34;&gt;2.创建TiDB数据库并连接&lt;/h1&gt;&#xA;&lt;h2 id=&#34;21登录tidb-cloud跳转自动创建实例&#34;&gt;2.1登录&lt;a href=&#34;https://tidbcloud.com/&#34;&gt;TiDB Cloud&lt;/a&gt;跳转自动创建实例&lt;/h2&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260227233644034.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260227233644034.png&#34; alt=&#34;image-20260227233644034&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;点击&lt;code&gt;Cluster0&lt;/code&gt;进入实例。&lt;/p&gt;&#xA;&lt;h2 id=&#34;22左边列表选择sql-editor放置walinetidb内容按照为语句分配贴近界面执行每贴一个点击右上角的运行蓝色按钮直到完成&#34;&gt;2.2左边列表选择SQL Editor放置&lt;a href=&#34;https://github.com/walinejs/waline/blob/main/assets/waline.tidb&#34;&gt;waline.tidb&lt;/a&gt;内容按照&lt;code&gt;;&lt;/code&gt;为语句分配贴近界面执行。每贴一个点击右上角的运行蓝色按钮直到完成。&lt;/h2&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260227235521224.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260227235521224.png&#34; alt=&#34;image-20260227235521224&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;h2 id=&#34;23点击overview并点击connect&#34;&gt;2.3点击Overview并点击Connect.&lt;/h2&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E5%8F%82%E6%95%B0.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%E5%8F%82%E6%95%B0.png&#34; alt=&#34;参数&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;h2 id=&#34;24vercel部署parameters参数&#34;&gt;2.4VERCEL部署Parameters参数&lt;/h2&gt;&#xA;&lt;p&gt;在vercel的Environment Variables填写&lt;code&gt;TIDB_HOST&lt;/code&gt;、&lt;code&gt;TIDB_PORT&lt;/code&gt;、&lt;code&gt;TIDB_DB&lt;/code&gt;、&lt;code&gt;TIDB_USER&lt;/code&gt;和&lt;code&gt;TIDB_PASSWORD&lt;/code&gt;的参数信息，原三项&lt;code&gt;LEAN_ID&lt;/code&gt;、&lt;code&gt;LEAN_KEY&lt;/code&gt;、&lt;code&gt;LEAN_MASTER_KEY&lt;/code&gt;可删除。&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228002712223.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228002712223.png&#34; alt=&#34;image-20260228002712223&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;并选择重新部署。&lt;/p&gt;&#xA;&lt;h1 id=&#34;3将leancloud评论迁徙数据到tidb&#34;&gt;3.将LeanCloud评论迁徙数据到TiDB&lt;/h1&gt;&#xA;&lt;p&gt;简单点的话，直接导入waline的&lt;code&gt;JSON&lt;/code&gt;文档，像这样。&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228004041658.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228004041658.png&#34; alt=&#34;image-20260228004041658&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;有点难度的话，就按照凡梦星尘的文章&lt;a href=&#34;https://lisenhui.cn/tech/migrate-waline-into-tidb-neon.html&#34;&gt;《迁移LeanCloud的Waline评论数据到TiDB/Neon》&lt;/a&gt;去做。&lt;/p&gt;&#xA;&lt;p&gt;首先，点击TiDB 集群页面右上角的 &lt;code&gt;Connect&lt;/code&gt; 按钮，获取数据库连接信息&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%25E5%258F%2582%25E6%2595%25B0.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/%25E5%258F%2582%25E6%2595%25B0.png&#34; alt=&#34;参数&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;然后再打开&lt;a href=&#34;https://github.com/elkan1788/waline-data-import-tool/releases/tag/v2.0.0&#34;&gt;工具链接&lt;/a&gt;，下载你的电脑操作环境，下载导入数据：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;./waline-data-import-tool-xxx -c waline-tidb.ini -f /root/elkan/waline.json&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里的-xxx是下载的工具链接。我是Windows，所以是&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;waline-data-import-tool.exe.zip&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;及下载&lt;a href=&#34;https://github.com/elkan1788/waline-data-import-tool/releases/download/v2.0.0/waline-data-import-tool-darwin-amd64&#34;&gt;waline-data-import-tool-darwin-amd64&lt;/a&gt;，假如文件都在F盘，则是：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd F:\waline&#xA;waline-data-import-tool-waline-data-import-tool.exe -c waline-tidb.ini -f waline.json&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;一键迁移数据就行了。&lt;/p&gt;&#xA;&lt;h1 id=&#34;4后续问题&#34;&gt;4.后续问题&lt;/h1&gt;&#xA;&lt;p&gt;我部署好waline后用了下，发现了几个问题：&lt;strong&gt;1&lt;/strong&gt;.管理员一评论，waline就下线需要重新登录 **2.&lt;strong&gt;管理员不能直接删除陌生人留言，必须到waline系统管理中方可删除评论&lt;/strong&gt;3.**评论中不再直接显示评论人地址，只能在管理系统后台查看IP。&lt;/p&gt;&#xA;&lt;p&gt;对于前二个问题，问了AI，给了我一个结果→&lt;strong&gt;JWT校验失败&lt;/strong&gt;（参看图片错误）。&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;J:%5c0ded62c7-f584-42f2-83c7-f7424bdf8f83.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;J:%5c0ded62c7-f584-42f2-83c7-f7424bdf8f83.png&#34; alt=&#34;0ded62c7-f584-42f2-83c7-f7424bdf8f83&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;解决办法也很简单，就是在vercel管理waline评论打开》设置》环境变量中设置 &lt;strong&gt;JWT-SECRET&lt;/strong&gt;,Value只要一串足够长的字符串就行，比如：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;waline_2026_super_secret_key_xxxxxxxxx&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;像这样：&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228133432244.png&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/image-20260228133432244.png&#34; alt=&#34;image-20260228133432244&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;这样，前二个问题就能解决了。至于第三个问题，不再显示评论仍IP，这个可能和TiDB存储库IP功能缺少有关，看后续能不能解决。&lt;/p&gt;&#xA;&lt;p&gt;参考： &lt;a href=&#34;https://lisenhui.cn/&#34;&gt;凡梦星尘的博客&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&#xD;&#xA;&lt;div class=&#34;post-img-view&#34;&gt;&#xD;&#xA;&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/NationalGeographic_2572187_16x9.jpg&#34;&gt;&#xD;&#xA;&lt;img src=&#34;https://css-1252531711.cos.ap-chongqing.myqcloud.com/picture/NationalGeographic_2572187_16x9.jpg&#34; alt=&#34;Domestic cat | National Geographic&#34;  /&gt;&#xD;&#xA;&lt;/a&gt;&#xD;&#xA;&lt;/div&gt;&#xD;&#xA;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
